<!--A Design by Kasbah System Software
Author: Kasbah System Software
-->
<!DOCTYPE HTML>
<html>
<head>
    <title>UMSLite | Login :: Student Portal</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    <link rel="stylesheet" type="text/css" href="web/css/login/style.css?rand=123456" />
    <link rel="stylesheet" type="text/css" href="web/css/login/animate-custom.css?rand=123456" />
    <link rel="stylesheet" type="text/css" href="web/css/style.css?rand=123456" />
    <link rel="stylesheet" type="text/css" href="web/css/login/bootstrap.css?rand=123456" />
    <link href="web/css/ModalDialog.css?rand=123456" rel="stylesheet" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Carrois+Gothic+SC' rel='stylesheet'
        type='text/css' />
    <script type="text/javascript" src="web/js/jquery.js?rand=123456"></script>
    <script type="text/javascript" src="web/js/json.js?rand=123456"></script>
    <script src="web/js/jstorage.js?rand=123456" type="text/javascript"></script>
    <script type="text/javascript" src="web/js/Common/Common.js?rand=123456"></script>
    <script src="web/js/CommonAjax.js?rand=123456"></script>
    <script src="web/js/jquery.base64.js?rand=123456"></script>
    <link rel="stylesheet" type="text/css" href="Content/themes/base/jquery-ui.css?rand=123456" />
    <script type="text/javascript" src="Scripts/jquery-ui-1.10.4.js?rand=123456"></script>
    <script type="text/javascript" src="web/js/login.js?rand=123456"></script>
</head>
<script type="text/javascript">


    function validate() {
        if (document.getElementById("txtUserName").value.trim() != "" && document.getElementById("txtPassword").value.trim() != "")
            return true;
        else
            return false;
    }

    function NavigatePage() {
        var isCorrect = validate();
        if (!isCorrect) {
            document.getElementById("txtPassword").value = "";
            alert('Please enter the studentid and password.');
            document.getElementById("txtUserName").focus();
        }
        else {
            if (!window.location.origin) { // Some browsers (mainly IE) does not have this property, so we need to build it manually...
                window.location.origin = window.location.protocol + '//' + window.location.hostname + (window.location.port ? (':' + window.location.port) : '');
            }

            $.jStorage.set("ServiceURL", location.origin + "/student/StudentMobileService.svc/");

            CheckStudentCredentials();

        }
    }

    function CheckStudentCredentials() {        
        var url = $.jStorage.get("ServiceURL") + 'GetStudentUserCreationByStudentIDAndPassword';
        var isValidCredential = false;
        var username = $.base64.encode(document.getElementById("txtUserName").value);
        var password = $.base64.encode(document.getElementById("txtPassword").value);

        var credentials = { StudentID: username, Password: password };

        var objectAsJson = $.toJSON(credentials);

        document.getElementById('divLoading').style.display = "";
        window.location.href = "#divLoading";

        $.ajax(
        {
            dataType: "json",
            type: "POST",
            url: url,
            contentType: "application/json; charset=utf-8",
            data: objectAsJson,

            success: (function (json, status, xhr) {

                var studentDetailList = json;

                document.getElementById('divLoading').style.display = "none";
                if (studentDetailList.entStudentUserCreation != "" && studentDetailList.entStudentUserCreation != null) {                    
                    // Check Status is Active /  InActive
                    if (studentDetailList.entStudentUserCreation.IsActive == "Y") {

                        $.jStorage.set("studentID", studentDetailList.entStudentUserCreation.StudentID);
                        //$.jStorage.set("studentPassword", studentDetailList.entStudentUserCreation.Password);

                        $.jStorage.set("Ums_SessionId", xhr.getResponseHeader("Ums_SessionId"));
                        if (studentDetailList.entStudentUserCreation.IsFirstTimeLogin == "Y") {
                            document.getElementById('divChangePassword').style.display = "";
                            window.location.href = "#divChangePassword";
                            document.getElementById('txtOldPassword').focus();
                        }
                        else {
                            document.cookie = "SessionID=" + Math.random();
                            $.jStorage.set('ExpireSessionID', Math.random(), { TTL: 1000 * 60 * 20 });
                            window.location.href = "Index.html?";
                        }
                        return true;
                    }
                    else {
                        alert('Your Login-ID is Inactive. Please contact administrator.');
                        document.getElementById("txtPassword").value = "";
                        document.getElementById("txtPassword").focus();
                        clearJsonStorage()
                        return false;
                    }
                }
                else {
                    alert('Please enter the valid studentid and password.');
                    document.getElementById("txtPassword").value = "";
                    document.getElementById("txtPassword").focus();
                    clearJsonStorage()
                    return false;
                }
            }),
            error: (function (jqxhr, textStatus, error) {
                document.getElementById('divLoading').style.display = "none";
                alert(textStatus);
                alert('Login Service not available. Contact Administrator.');
                clearJsonStorage()
                return false;
            })
        });
    }

    $(document).keypress(function (e) {
        if (e.which == 13) {
            if (document.getElementById('divChangePassword').style.display == "")
                ChangePassword();
            else if (document.getElementById('divForgetPassword').style.display == "")
                ForgetPassword();
            else
                NavigatePage();
        }
    });

    window.onload = function () { document.getElementById("txtUserName").focus(); }

    function fnForgetPassword() {
        var date = new Date();
        document.getElementById('dob').max = date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear();
        document.getElementById('dob').maxLength = parseInt(date.getFullYear());
        document.getElementById('divForgetPassword').style.display = '';
        window.location.href = "#divForgetPassword";
        document.getElementById('txtStudentID').focus();
    }


</script>
<body class="fade-in" oncontextmenu="return false;">
    <div class="wrap">
        <table width="100%" style="vertical-align: top; margin-top: 2%;">
            <tr>
                <td>
                    <img src="web/images/logo.jpg" height="118px" width="100%" />
                </td>
            </tr>
        </table>
    </div>
    <div class="main">
        <div class="wrap">
            <div class="menu_box_list" style="margin-top: -5%; height: 675px;">
                <div class="menu_box" style="margin-bottom: 1.5%;">
                    <!-- start Login box -->
                    <div class="container" id="login-block">
                        <div class="row">
                            <div class="col-sm-6 col-md-4 col-sm-offset-3 col-md-offset-4">
                                <div class="login-box clearfix animated flipInY">
                                    <div class="page-icon animated bounceInDown">
                                        <img src="web/images/login-logo.png" alt="Key icon" class="" />
                                    </div>
                                    <div class="login-logo">
                                        <br />
                                        <label style="color: White; font-size: 2em;">
                                            Student Login
                                        </label>
                                    </div>
                                    <hr>
                                    <div class="login-form">
                                        <form>
                                        <input id="txtUserName" type="text" placeholder="Student Id" class="input-field"
                                            required="">
                                        <input id="txtPassword" type="password" placeholder="Password" class="input-field"
                                            required="">
                                        <button id="btnSubmit" type="button" value="Login" onclick="NavigatePage();" class="btn btn-login">
                                            Login</button>
                                        <a onmouseover="this.style.color='yellow';" onmouseout="this.style.color='white';"
                                            onclick="fnForgetPassword();"><b>Forgot Password?</b></a>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Login box -->
                        <footer class="container">
                            <p id="footer-text">
                            <br />
                            <a style="color: #4ac4ec;text-decoration:underline;" href="#" id="payment">Payment Terms and Conditions</a>
                            <br />
                             <br />
                                <small>Copyright © 2016 <a style="color: #4ac4ec" target="_blank" href="http://www.kassoftindia.com/">
                                    Kasbah System Software</a></small></p>
                        </footer>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="divChangePassword" class="windowModal" style="display: none;">
        <div align="center">
            <a href="#close" title="Close" class="closeDialog" onclick="fnClose('ChangePassword');">
                X</a>
            <div class="login-box">
                <div class="page-icon">
                    <img src="web/images/login-logo.png" alt="key icon" class="" />
                </div>
                <div class="login-logo">
                    <br />
                    <label style="color: white; font-size: 2em;">
                        change password
                    </label>
                </div>
                <hr>
                <div class="login-form">
                    <form action="#" method="get">
                    <input type="password" id="txtOldPassword" style="border-radius: 5px" placeholder="type your old password here"
                        class="input-field" required />
                    <input type="password" id="txtNewPassword" style="border-radius: 5px" class="input-field"
                        placeholder="type your new password here" required />
                    <input type="password" id="txtConfirmPassword" style="border-radius: 5px" class="input-field"
                        placeholder="retype your new password here" required />
                    <button id="button1" type="button" value="submit" onclick="ChangePassword();" class="btn btn-login">
                        submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div id="divForgetPassword" class="windowModal" style="display: none;">
        <div align="center">
            <a href="#close" title="close" class="closeDialog" onclick="fnClose('ForgetPassword');">
                x</a>
            <div class="login-box">
                <div class="page-icon">
                    <img src="web/images/login-logo.png" alt="key icon" class="" />
                </div>
                <div class="login-logo">
                    <br />
                    <label style="color: white; font-size: 2em;">
                        Forget password
                    </label>
                </div>
                <hr>
                <div class="login-form">
                    <form action="#" method="get">
                    <input type="text" id="txtStudentID" style="border-radius: 5px" placeholder="Type your StudentID"
                        class="input-field" required />
                    <input type="text" id="txtEmailID" style="border-radius: 5px" class="input-field"
                        placeholder="Type your Email-ID" required />
                    <input id="dob" readonly placeholder="Select Your Date of Birth(dd-MM-yyyy)" />
                    <button id="btnForgetSubmit" type="button" value="submit" onclick="ForgetPassword();"
                        class="btn btn-login">
                        submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="divLoading" class="windowModal" style="display: none; padding-top: 20%;
        padding-left: 45%;">
        <svg xmlns="http://www.w3.org/2000/svg" width="114px" height="114px" viewbox="0 0 100 100"
            preserveaspectratio="xMidYMid" class="uil-squares">
   <rect x="0" y="0" width="100" height="100" fill="none" class="bk"/>
   <rect x="15" y="15" width="20" height="20" fill="#047ab3" class="sq">
   <animate attributeName="fill" from="#047ab3" to="#00cde8" repeatCount="indefinite" dur="1s" begin="0s" values="#00cde8;#00cde8;#047ab3;#047ab3" keyTimes="0;0.1;0.2;1"/>
   </rect>
   <rect x="40" y="15" width="20" height="20" fill="#047ab3" class="sq"><animate attributeName="fill" from="#047ab3" to="#00cde8" repeatCount="indefinite" dur="1s" begin="0.125s" values="#00cde8;#00cde8;#047ab3;#047ab3" keyTimes="0;0.1;0.2;1"/></rect><rect x="65" y="15" width="20" height="20" fill="#047ab3" class="sq"><animate attributeName="fill" from="#047ab3" to="#00cde8" repeatCount="indefinite" dur="1s" begin="0.25s" values="#00cde8;#00cde8;#047ab3;#047ab3" keyTimes="0;0.1;0.2;1"/></rect><rect x="15" y="40" width="20" height="20" fill="#047ab3" class="sq"><animate attributeName="fill" from="#047ab3" to="#00cde8" repeatCount="indefinite" dur="1s" begin="0.875s" values="#00cde8;#00cde8;#047ab3;#047ab3" keyTimes="0;0.1;0.2;1"/></rect><rect x="65" y="40" width="20" height="20" fill="#047ab3" class="sq"><animate attributeName="fill" from="#047ab3" to="#00cde8" repeatCount="indefinite" dur="1s" begin="0.375s" values="#00cde8;#00cde8;#047ab3;#047ab3" keyTimes="0;0.1;0.2;1"/></rect><rect x="15" y="65" width="20" height="20" fill="#047ab3" class="sq"><animate attributeName="fill" from="#047ab3" to="#00cde8" repeatCount="indefinite" dur="1s" begin="0.75s" values="#00cde8;#00cde8;#047ab3;#047ab3" keyTimes="0;0.1;0.2;1"/></rect><rect x="40" y="65" width="20" height="20" fill="#047ab3" class="sq"><animate attributeName="fill" from="#047ab3" to="#00cde8" repeatCount="indefinite" dur="1s" begin="0.625s" values="#00cde8;#00cde8;#047ab3;#047ab3" keyTimes="0;0.1;0.2;1"/></rect><rect x="65" y="65" width="20" height="20" fill="#047ab3" class="sq"><animate attributeName="fill" from="#047ab3" to="#00cde8" repeatCount="indefinite" dur="1s" begin="0.5s" values="#00cde8;#00cde8;#047ab3;#047ab3" keyTimes="0;0.1;0.2;1"/></rect>
   <text x="30" y="100"  font-size="8px" fill="White">LOADING...</text>
   </svg>
    </div>
</body>
</html>