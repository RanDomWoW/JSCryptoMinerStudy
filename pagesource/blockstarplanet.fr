<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>BlockStarPlanet</title>
	
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?version=1">
	
	<link rel="icon" href="/favicon.ico?version=1" type="image/x-icon" />
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?version=1" />
	
	<link rel="icon" type="image/png" href="/favicon-32x32.png?version=1" sizes="32x32">
	<link rel="icon" type="image/png" href="/favicon-16x16.png?version=1" sizes="16x16">
	
	<link rel="manifest" href="/manifest.json?version=1">
	<link rel="mask-icon" href="/safari-pinned-tab.svg?version=1" color="#5bbad5">
	<meta name="theme-color" content="#ffffff">
	
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/favicon-144.png?version=1">

	<meta name="description" content="" />
	<meta name="apple-itunes-app" content="app-id=881010518">
	<link rel="stylesheet" type="text/css" href="css/html5-style.css?v=3">
	<link rel="stylesheet" type="text/css" href="css/roboblast.css?version=7">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
	<script src="js/swfobject-2.3-src.js?v=3"></script>
	<script src="js/app.js?v=2"></script>	
	<script type="text/javascript" src="js/mspuniverse.min.js?v=3"></script>
	<script type="text/javascript" src="js/fp2.min.js?v=1"></script>
	<script type="text/javascript" src="https://track.adform.net/serving/scripts/trackpoint/"></script>
	<script type="text/javascript" src="js/tracking.js?v=1"></script>
	
    <script type="text/javascript" src="js/w2ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/w2ui.min.css" />
    
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
</head>
<body>	
	<div id="gameContainer">
		<div id="flashDiv"></div>
		<video id="simple_video_content" style="display:none; position:absolute"></video>
		<div id="mainContainer">
			<div id="content" style="display:none">
				<video id="video_ad_content_element">
				</video>
			</div>
			<div id="video_ad_container" style="display:none"></div>
			<script type="text/javascript" src="//imasdk.googleapis.com/js/sdkloader/ima3.js?v=1"></script>
			<script type="text/javascript" src="js/ima.js?v=2"></script>
		</div>
				
		<div id="black_blocker" style="display:block"></div>
	</div>
	
	<script>
	
		if ( window.self !== window.top ) 
		{
			$.getJSON("https://iframe.mspcdns.com/whitelist.json", {version: new Date().getTime()}, function(json)
			{
				var valid = false;
				
				if(json != null)
				{
					var url = extractHostname();
					
					if(url != null)
					{
						var sites;
						var len;
						var site;
						
						for(var key in json)
						{
							sites = json[key];
							
							if(sites && sites.length > 0)
							{
								len = sites.length;
								
								for(var i = 0;i<len;i++)
								{
									site = sites[i].toLowerCase();
									
									if(url == site)
									{
										valid = true;
										break;
									}
								}
							}
							
							if(valid)
							{
								break;
							}
						}
					}
				}
				
				if(!valid)
				{
					window.top.location.href=window.location.href;
				}
			});
		}		
		
		function extractHostname()
		{
			var url = document.referrer.toLowerCase();
			var hostname;
			
			if(url != null && url.length > 0)
			{
				if (url.indexOf("://") > -1)
				{
					hostname = url.split('/')[2];
				}
				else
				{
					hostname = url.split('/')[0];
				}
				
				hostname = hostname.split(':')[0];
				hostname = hostname.split('?')[0];
				
				if ((hostname.indexOf("www.") == 0))
				{
					hostname = hostname.substring(4, hostname.length);
				}
			}

			return hostname;
		}
		
		var fingerprint = 'unknown';
		var universe;
		
		window.FlashDetected = function()
	    {
	       app.init();
			
			defineGameDimensions();
			startRBPFlash();
	    }
		
		$(function(){
		   	universe = new MSPUniverse();
		  	universe.game.minFlashVersion="10.0.0";
		 	universe.game.flashTesterDiv = "flashTestContent";

			//Register object so it will be prompted to expressInstall if necessary
			swfobject.registerObject("flashTestContent", universe.game.minFlashVersion, "swf/expressInstall.swf"); 
		 
			//Check if it is mobile and redirect (It will add and send the current querystring)
			universe.redirectIfMobile("/index_mobile.html");
			
			//Initialize the environment and check for browser, device, language
			universe.environment.init(
				function()
				{
					var options = { excludeAdBlock: true, excludeCanvas:true};
					var fp = new Fingerprint2(options);
					fp.get(function (result) {
						fingerprint = result;
					});
				
					app.init();
			
					defineGameDimensions();
					versionCheck();
				}
			);
		}); 
		
		function getFingerprint()
		{
			return fingerprint;
		}	
		
		function getBrowser()
		{
			return universe.browser.specs.name + " - " + universe.browser.specs.version;
		}
		
	    function stopVideo()
		{
			var video_player = document.getElementById("simple_video_content");
			video_player.pause();
			
			$(simple_video_content).css('display','none');
	    }

		function playVideo(videoUrl)
		{
			var video_player = document.getElementById("simple_video_content");
			video_player.src = videoUrl;
			video_player.addEventListener("ended", onVideoEnded);
			//video_player.ended = onVideoEnded;
			video_player.play();
			
			$(simple_video_content).css('display','block');
		}
		
		function onVideoEnded()
		{
			$("#BuilderGame").get(0).OnSimpleVideoEnded();
		}
		
		function showBottomBar()
		{
			$("#page_bottom_container").animate({bottom: "0"});
		}
		
		function hideBottomBar()
		{
			$("#page_bottom_container").animate({bottom: "-120"});
		}
		
		var gameWidth = "1920";
		var gameHeigth = "1080";

		var alreadyShown = false;
		
		function defineGameDimensions()
		{
			var applyScale = true;
			
			var parameters = window.location.search.substring(1);
			
			if(parameters != null && parameters != "")
			{
				var splittedParameters = parameters.split("&");
				var paramValues = null;
				var i = 0;
				
				for(i; i<splittedParameters.length; i++)
				{
					paramValues = splittedParameters[i].split("=");
					if(paramValues && paramValues.length == 2)
					{	
						if(paramValues[0] == "w")
						{
							gameWidth = paramValues[1];
							applyScale = false;
						}
						else if(paramValues[0] == "h")
						{
							gameHeigth = paramValues[1];
							applyScale = false;
						}
					}
				}
			}
			
			var scale = 1;
			
			if(applyScale)
			{
				var windowHeight = $(window).height();
				var windowWidth = $(window).width();
										
				windowWidth = windowWidth < 200 ? 200 : windowWidth;
				windowHeight = windowHeight < 200 ? 200 : windowHeight;
												
				gameHeigth = windowHeight;
				gameWidth = windowWidth;
			}
			
			document.getElementById("gameContainer").style.width = gameWidth + "px";
			document.getElementById("gameContainer").style.height = gameHeigth + "px";
					
			var gameScaleW = gameWidth / 1024;
			var gameScaleH = gameHeigth / 768;
											
			var gameScale = gameScaleW < gameScaleH ? gameScaleW : gameScaleH;
		
			var videoW = 896 * gameScale;
			var videoH = 504 * gameScale;
		
			var videoX = gameWidth * 0.5 - videoW * 0.5;
			var videoY = gameHeigth * 0.5 - videoH * 0.5 - 13 * gameScale;
		
			placeVideoPlayers(
					videoX, 
					videoY, 
					videoW, 
					videoH
			);
		}
		
		function placeVideoPlayers(x, y, w, h)
		{
			document.getElementById("video_ad_container").style.width = w + "px";
			document.getElementById("video_ad_container").style.height =  h + "px";
			document.getElementById("video_ad_container").style.left = x + "px";
			document.getElementById("video_ad_container").style.top =  y + "px";
			
			document.getElementById("simple_video_content").style.width = w + "px";
			document.getElementById("simple_video_content").style.height =  h + "px";
			document.getElementById("simple_video_content").style.left = x + "px";
			document.getElementById("simple_video_content").style.top =  y + "px";
			
			if (typeof setAdVideoPlayerSize === "function") 
			{
				setAdVideoPlayerSize(w,h);
			}
		}
		
		function isAdsReadyToUse()
		{
			try
			{
				return isAdsLibraryReady();
			}
			catch(error)
			{
				return false;
			}
		}
		
		function loadBuildVersionData()
		{		
			$.get("teamcityversion.json", {version: new Date().getTime()}, function(data)
			{
				if(data != null)
				{
					//$("#body").append("<div id=" + "version" + "></div>");
					//document.getElementById("version").innerHTML = data;
				}
			});
		}
		
		//loadBuildVersionData();
					
		function jsTest()
		{
			
		}
				
		var beforeUnloadTimeout = 0 ;
		
			
		//Check that all the variables we need are in place
		function versionCheck()
		{
			//We got all versions
			universe.game.onEmbedSuccess = function()
			{
				$('.alternateContainer').remove();
				universe.game.onEmbedSuccess = null;
				startRBPFlash();
			}

			universe.game.onEmbedFail = function()
			{
				startNoFlashPresentation();
			}
			
			//Embed a sample to check FlashPlayer
			universe.game.checkFlashPlayerWithSample("swf/sampleswf.swf", universe.browser.isFirefox);
		}	
		
		//User doesn't have flash player installed or active
		function startNoFlashPresentation()
		{
			var alternateContentDiv = "alternateContent";
			//Avoid multiple calls
			if(alreadyShown)
			{
				return;
			}
			alreadyShown = true;

			//Get visits cookie
			visits = Cookies.prototype.getCookie.call(this,'visited') || 1;

			//Check which browser is it
			if (universe.browser.isFirefox)
			{
				universe.browser.flashDetect.showAlternateContent("steps/Mozilla/Firefox.html",alternateContentDiv,alternateContentLoaded);
			}
			else if(universe.browser.isChrome)
			{
				universe.browser.flashDetect.showAlternateContent("steps/Chrome/Chrome.html",alternateContentDiv,alternateContentLoaded);
			}
			else if(universe.browser.isEdge && visits==2)
			{
				universe.browser.flashDetect.showAlternateContent("steps/Edge/Edge.html",alternateContentDiv,alternateContentLoaded);
			}
			else if(universe.browser.isIE && visits==2)
			{
				universe.browser.flashDetect.showAlternateContent("steps/IE/IE.html",alternateContentDiv,alternateContentLoaded);
			}
			else if(universe.browser.isSafari && visits==2)
			{
				universe.browser.flashDetect.showAlternateContent("steps/Safari/Safari.html",alternateContentDiv,alternateContentLoaded);
			}
			else
			{
				universe.browser.flashDetect.showAlternateContent("steps/PlayerMissing.html",alternateContentDiv,alternateContentLoaded);
			}
			//Change the cookie value
			toggleCookie();
		}
			
		function toggleCookie()
		{
			if(visits==1)
			{
				universe.cookies.setCookie('visited', 2,30);
			}
			else
			{
				universe.cookies.setCookie('visited', 1,30);
			}
		}

		function alternateContentLoaded()
		{
			//Fade in the content
			$('.alternateContainer').show();
			$('.alternateContainer').fadeIn();

			// Work on this for V1.0
			//Put the express Install swf into the content holder (This id SWFObjectExprInst is inside the swfobject lib)
			if($('#SWFObjectExprInst').length > 0)
			{ 
				//Try and get a container from browser specific html
				if($('#expressInstallContainer').length>0)
				{
					$('#expressInstallContainer').css('display','block');
					$('#SWFObjectExprInst').appendTo('#expressInstallContainer');
				}
				
				$('#SWFObjectExprInst').css({
					'width':'220px',
					'height':'135px',
					'z-index' : '2000',
				});
			}
			
		}

		function startRBPFlash()
		{
			var params = 
			{
				menu: "false",
				scale: "noScale",
				allowFullscreen: "true",
				allowScriptAccess: "always",
				bgcolor: "#000000",
				wmode: "direct" // can cause issues with FP settings & webcam
			};
			
			var flashvars = 
			{
			
			};

			var attributes = 
			{
				id:"BuilderGame"
			};
			
			var parameters = window.location.search.substring(1);
			var swfPath = "BuilderGame.swf?v=3151&" + parameters
			
			universe.game.onEmbedSuccess = function()
			{
				//A bug in swfObject doesn't call this.
				$('.alternateContainer').remove();
				$('#flashDiv').css("display","block");
				$("#black_blocker").delay(1000).fadeOut(2000);


				$(window).bind('beforeunload', 
				function () 
				{
					$("#BuilderGame").get(0).OnWebsiteExit();
					
					beforeUnloadTimeout = setTimeout(
						function() 
						{
							$("#BuilderGame").get(0).OnWebsiteResume();
						},50);
					
					return 'Save Warning Message';               
				});

			}

			universe.game.onEmbedFail = function()
			{
				$("#black_blocker").delay(1000).fadeOut(2000);
			}

			universe.game.embedGame(
					swfPath,
					"flashDiv",
					flashvars,
					params,
					attributes,
					gameWidth, 
					gameHeigth, 
					"swf/expressInstall.swf");						
		}	
		
        var toCopy = '';
        function showStatsInformation(value)
        {
            var lines = value.split(";");
            
            toCopy = '';
            
            var len = lines.length;
            var items = '<div style="text-align: center">';
            for(var i = 0;i<len;i++)
            {
                items += '<li>' + lines[i] + '</li>'
                toCopy += lines[i] + '\r\n';
            }
            
            items += '</div>';
            
            w2popup.open({
                title: 'Game Information',
				modal: true,
                body: '<div id="stats_content" class="w2ui-centered">'  + items + '</div>',
                buttons   : '<button class="w2ui-btn" onclick="showCopyToClipboardMessage()">Copy</button> '+
                    '<button class="w2ui-btn" onclick="w2popup.close();">Close</button>' + 
					'<button class="w2ui-btn" onclick="onGetPing(); w2popup.close();">Get Ping</button>'
            });
        }
		
		function onGetPing()
		{
			w2utils.lock($('#gameContainer'), { spinner: true, opacity : 0.75 });
			$("#BuilderGame").get(0).OnGetPing();
		}
		
		function showPingResults(value)
		{
			w2utils.unlock($('#gameContainer'));
		
			var lines = value.split(";");
            
            var len = lines.length;
            var items = '<div style="text-align: center">';
            for(var i = 0;i<len;i++)
            {
                items += '<li>' + lines[i] + '</li>'
                toCopy += lines[i] + '\r\n';
            }
		
			w2popup.open({
                title: 'Ping',
				modal: true,
                body: '<div id="stats_content" class="w2ui-centered">'  + items + '</div>',
                buttons   : '<button class="w2ui-btn" onclick="w2popup.close();">Close</button>'
            });
		}
        
        function showCopyToClipboardMessage () 
        {
            copyToClipboard('stats_content');
            
            w2popup.message({ 
                width   : 400, 
                height  : 180,
                html    : '<div style="padding: 60px; text-align: center">Copied to clipboard</div>'+
                          '<div style="text-align: center"><button class="w2ui-btn" onclick="w2popup.message()">Close</button>'
            });
        }
        
        function copyToClipboard(containerid) 
        {
            if (document.selection) 
            { 
                var range = document.body.createTextRange();
                range.moveToElementText(document.getElementById(containerid));
                range.select().createTextRange();
                document.execCommand("copy"); 
            } 
            else if (window.getSelection) 
            {
                var range = document.createRange();
                range.selectNode(document.getElementById(containerid));
                window.getSelection().addRange(range);
                document.execCommand("copy");
            }
        }
        
	</script>
		
	<div class="alternateContainer">
		<canvas id="canvas" style="display: block; background-color:rgba(102, 102, 102, 0);"></canvas>
		<div id="alternateContent" style="position:absolute;width:100%;height: 100%;top:0"></div>
		<div id="flashTestContent" style="visibility: hidden"></div>
	</div>
	
	<div id="page_bottom_container">
		<div id="page_bottom_background"></div>
		<div id="page_bottom_trademark_text"> &copy; MovieStarPlanet 2018</div>
		<div id="page_bottom_separator"></div>
		<div id="page_bottom_options">
			<a href="https://corporate.moviestarplanet.com" target="_blank" class="menulink">Corporate</a>
			<a href="https://moviestarplanet.zendesk.com/hc" target="_blank" class="menulink">Contact</a>
			<a href="https://moviestarplanet.zendesk.com/hc/articles/115000385689" target="_blank" class="menulink">Safety</a>
			<a href="https://moviestarplanet.zendesk.com/hc/articles/213892145" target="_blank" class="menulink">Terms & Conditions</a>
			<a href="https://moviestarplanet.zendesk.com/hc/articles/213208965" target="_blank" class="menulink">Privacy Policy</a>
			<a href="https://moviestarplanet.zendesk.com/hc/articles/214480005" target="_blank" class="menulink">Parents Guide</a>
		</div>
		<div id="page_bottom_social_options">
			<a href="https://itunes.apple.com/dk/app/roboblastplanet/id881010518?mt=8" style="text-decoration:none;" title="Download BlockStarPlanet on Apple Store!">
				<img src="images/site/apple_store_small.png" alt="" />
			</a>
			<a href="https://play.google.com/store/apps/details?id=air.com.moviestarplanet.roboblastplanet" style="text-decoration:none;" title="Download BlockStarPlanet on Google Play!">
				<img src="images/site/google_store_small.png" alt="" />
			</a>
		</div>
	</div>
	
</body>
</html>